<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>VibeTime</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #e94560;
        }
        
        .clock {
            font-size: 4rem;
            font-weight: 300;
            font-variant-numeric: tabular-nums;
            margin: 20px 0;
            color: #fff;
        }
        
        .main-button {
            background: linear-gradient(135deg, #e94560 0%, #0f3460 100%);
            border: none;
            color: white;
            padding: 20px 40px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px 0;
            transition: transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }
        
        .main-button:active {
            transform: scale(0.95);
        }
        
        .main-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .settings {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            width: 100%;
            max-width: 350px;
        }
        
        .settings h2 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: #aaa;
        }
        
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .setting-row:last-child {
            border-bottom: none;
        }
        
        .toggle {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: 0.3s;
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        .toggle input:checked + .toggle-slider {
            background-color: #e94560;
        }
        
        .toggle input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .test-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .test-btn:active {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .help {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            width: 100%;
            max-width: 350px;
            font-size: 0.85rem;
            color: #aaa;
        }
        
        .help h3 {
            color: #ddd;
            margin-bottom: 10px;
        }
        
        .pattern-display {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            min-height: 40px;
            font-size: 0.9rem;
        }
        
        .status {
            color: #e94560;
            font-size: 0.9rem;
            margin-top: 10px;
            min-height: 20px;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            color: #ffc107;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.85rem;
            text-align: center;
            max-width: 350px;
        }
    </style>
</head>
<body>
    <h1>‚è± VibeTime</h1>
    
    <div class="clock" id="clock">00:00:00</div>
    
    <button class="main-button" id="vibeBtn">Feel Current Time</button>
    
    <div class="status" id="status"></div>
    
    <div id="warning" class="warning" style="display: none;">
        Vibration API not supported. Try Chrome or Firefox on Android.
    </div>
    
    <div class="settings">
        <h2>SETTINGS</h2>
        
        <div class="setting-row">
            <span>12-hour format</span>
            <label class="toggle">
                <input type="checkbox" id="format12">
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-row">
            <span>Include hours</span>
            <label class="toggle">
                <input type="checkbox" id="includeHours" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-row">
            <span>Include minutes</span>
            <label class="toggle">
                <input type="checkbox" id="includeMinutes" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>
    
    <div class="settings">
        <h2>TEST TIMES</h2>
        <div class="test-buttons">
            <button class="test-btn" data-hour="0" data-minute="0">00:00</button>
            <button class="test-btn" data-hour="8" data-minute="5">08:05</button>
            <button class="test-btn" data-hour="14" data-minute="37">14:37</button>
            <button class="test-btn" data-hour="23" data-minute="59">23:59</button>
        </div>
        <div class="pattern-display" id="patternDisplay">Tap a time to see pattern</div>
    </div>
    
    <div class="help">
        <h3>How it works</h3>
        <p>Time is encoded as vibrations:</p>
        <p><strong>LONG (250ms)</strong> = 5 units</p>
        <p><strong>SHORT (100ms)</strong> = 1 unit</p>
        <p>Example: 14 = 2 LONG + 4 SHORT</p>
    </div>
    
    <script>
        // Timing constants (ms)
        const LONG_PULSE = 250;
        const SHORT_PULSE = 100;
        const INTER_PULSE_PAUSE = 70;
        const SEPARATOR_PAUSE = 400;
        
        // State
        let isVibrating = false;
        
        // Elements
        const clockEl = document.getElementById('clock');
        const vibeBtn = document.getElementById('vibeBtn');
        const statusEl = document.getElementById('status');
        const patternEl = document.getElementById('patternDisplay');
        const warningEl = document.getElementById('warning');
        const format12El = document.getElementById('format12');
        const includeHoursEl = document.getElementById('includeHours');
        const includeMinutesEl = document.getElementById('includeMinutes');
        
        // Check vibration support
        const canVibrate = 'vibrate' in navigator;
        if (!canVibrate) {
            warningEl.style.display = 'block';
        }
        
        // Update clock display
        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            clockEl.textContent = `${h}:${m}:${s}`;
        }
        
        setInterval(updateClock, 1000);
        updateClock();
        
        // Build pattern for a number using tally system
        function buildNumberPattern(n) {
            if (n === 0) return [];
            
            const pattern = [];
            const longs = Math.floor(n / 5);
            const shorts = n % 5;
            
            // Add LONG pulses
            for (let i = 0; i < longs; i++) {
                if (pattern.length > 0) pattern.push(INTER_PULSE_PAUSE);
                pattern.push(LONG_PULSE);
            }
            
            // Add SHORT pulses
            for (let i = 0; i < shorts; i++) {
                if (pattern.length > 0) pattern.push(INTER_PULSE_PAUSE);
                pattern.push(SHORT_PULSE);
            }
            
            return pattern;
        }
        
        // Build complete time pattern
        function buildTimePattern(hour, minute, config) {
            let h = hour;
            
            // Handle 12-hour format
            if (config.use12Hour) {
                if (h === 0) h = 12;
                else if (h > 12) h -= 12;
            }
            
            const parts = [];
            
            if (config.includeHours) {
                parts.push({ value: h, pattern: buildNumberPattern(h) });
            }
            
            if (config.includeMinutes) {
                parts.push({ value: minute, pattern: buildNumberPattern(minute) });
            }
            
            // Combine patterns with separator
            const fullPattern = [];
            parts.forEach((part, idx) => {
                if (idx > 0 && fullPattern.length > 0) {
                    fullPattern.push(SEPARATOR_PAUSE);
                }
                fullPattern.push(...part.pattern);
            });
            
            return { pattern: fullPattern, parts };
        }
        
        // Describe pattern for display
        function describePattern(hour, minute, config) {
            let h = hour;
            if (config.use12Hour) {
                if (h === 0) h = 12;
                else if (h > 12) h -= 12;
            }
            
            const desc = [];
            
            if (config.includeHours) {
                const longs = Math.floor(h / 5);
                const shorts = h % 5;
                const parts = [];
                if (longs > 0) parts.push(`${longs}L`);
                if (shorts > 0) parts.push(`${shorts}S`);
                desc.push(`Hour ${h}: ${parts.length ? parts.join('+') : '(none)'}`);
            }
            
            if (config.includeMinutes) {
                const longs = Math.floor(minute / 5);
                const shorts = minute % 5;
                const parts = [];
                if (longs > 0) parts.push(`${longs}L`);
                if (shorts > 0) parts.push(`${shorts}S`);
                desc.push(`Min ${minute}: ${parts.length ? parts.join('+') : '(none)'}`);
            }
            
            return desc.join(' | ');
        }
        
        // Get current config
        function getConfig() {
            return {
                use12Hour: format12El.checked,
                includeHours: includeHoursEl.checked,
                includeMinutes: includeMinutesEl.checked
            };
        }
        
        // Vibrate time
        async function vibrateTime(hour, minute) {
            if (isVibrating) return;
            
            const config = getConfig();
            
            if (!config.includeHours && !config.includeMinutes) {
                statusEl.textContent = 'Enable hours or minutes!';
                return;
            }
            
            const { pattern } = buildTimePattern(hour, minute, config);
            
            if (pattern.length === 0) {
                statusEl.textContent = 'No vibration (value is 0)';
                return;
            }
            
            isVibrating = true;
            vibeBtn.disabled = true;
            statusEl.textContent = 'Vibrating...';
            
            // Vibration API expects: [vibrate, pause, vibrate, pause, ...]
            // Our pattern is already in this format
            if (canVibrate) {
                navigator.vibrate(pattern);
            }
            
            // Calculate total duration
            const totalDuration = pattern.reduce((a, b) => a + b, 0);
            
            await new Promise(resolve => setTimeout(resolve, totalDuration));
            
            isVibrating = false;
            vibeBtn.disabled = false;
            statusEl.textContent = '';
        }
        
        // Event listeners
        vibeBtn.addEventListener('click', () => {
            const now = new Date();
            vibrateTime(now.getHours(), now.getMinutes());
        });
        
        document.querySelectorAll('.test-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const hour = parseInt(btn.dataset.hour);
                const minute = parseInt(btn.dataset.minute);
                const config = getConfig();
                
                patternEl.textContent = describePattern(hour, minute, config);
                vibrateTime(hour, minute);
            });
        });
        
        // Update pattern display when settings change
        [format12El, includeHoursEl, includeMinutesEl].forEach(el => {
            el.addEventListener('change', () => {
                const lastBtn = document.querySelector('.test-btn:hover, .test-btn:focus');
                if (lastBtn) {
                    const hour = parseInt(lastBtn.dataset.hour);
                    const minute = parseInt(lastBtn.dataset.minute);
                    patternEl.textContent = describePattern(hour, minute, getConfig());
                }
            });
        });
    </script>
</body>
</html>
